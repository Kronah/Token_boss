<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login / Cadastro com Firebase</title>
    <!-- Inclui o Tailwind CSS para estilização fácil -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Define as fontes Inter (para texto geral) e Cinzel Decorative (para títulos) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Cinzel+Decorative:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif; /* Fonte padrão para todo o corpo */
            /* --- Início da Área para Personalizar o Fundo --- */
            /*
             * A URL da sua imagem de fundo do exército de Esparta.
             * Você pode trocá-la se quiser.
             */
            background-image:
                url('https://lh4.googleusercontent.com/_tiEzXvf6uDRZ1x-lkpcGl8tfFogCXcT9Qo5awoc_5C6oK_bIWabqjfGxafC48vLij-g6KOKSdgQg-_0gmKn99uwOPTY69Q4cghy3irecNGVHvz5hNHy6aqd5Fv3cqln1uu0eN0EFnJJp3SJfWXa2A4'); /* Sua imagem de fundo do exército de Esparta */
            background-size: cover; /* Faz a imagem cobrir todo o fundo */
            background-position: center; /* Centraliza a imagem no fundo */
            background-repeat: no-repeat; /* Evita que a imagem se repita */
            background-attachment: fixed; /* Mantém a imagem fixa ao rolar */
            /* --- Fim da Área para Personalizar o Fundo --- */
        }
        /* Aplica a fonte "300" (Cinzel Decorative) aos títulos */
        h1, h2 {
            font-family: 'Cinzel Decorative', serif;
            /* Adiciona um leve efeito de sombra para realçar o texto */
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">
    <div class="bg-white p-8 rounded-lg shadow-2xl w-full max-w-md bg-opacity-20">
        <h1 class="text-3xl font-bold text-center text-black mb-6">Acesso aos 300</h1>

        <div id="login-form" class="space-y-4">
            <div>
                <label for="email" class="block text-black text-sm font-semibold mb-2">Email</label>
                <input
                    type="email"
                    id="email"
                    class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-red-700 focus:border-red-700 transition duration-200 placeholder-black"
                    placeholder="seu.email@exemplo.com"
                >
            </div>
            <div>
                <label for="password" class="block text-black text-sm font-semibold mb-2">Senha</label>
                <input
                    type="password"
                    id="password"
                    class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-red-700 focus:border-red-700 transition duration-200 placeholder-black"
                    placeholder="********"
                >
            </div>
            <button
                id="login-button"
                class="w-full bg-red-800 text-white py-2 px-4 rounded-md hover:bg-red-900 focus:outline-none focus:ring-2 focus:ring-red-700 focus:ring-opacity-50 transition duration-300 transform hover:scale-105"
            >
                Entrar
            </button>
            <button
                id="signup-button"
                class="w-full bg-gray-700 text-white py-2 px-4 rounded-md hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-gray-600 focus:ring-opacity-50 transition duration-300 transform hover:scale-105"
            >
                Criar Nova Conta
            </button>
            <p id="message" class="text-center text-sm mt-4"></p>
        </div>

        <!-- A mensagem de boas-vindas foi removida daqui, pois o utilizador será redirecionado -->
        <!-- Direitos autorais -->
        <p class="text-center text-black text-xs mt-6">&copy; 2025 CaMoMiLa. Todos os direitos reservados.</p>
    </div>

    <!-- Firebase SDK (v9, modular) -->
    <script type="module">
        // Importa as funções necessárias do Firebase
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js';
        import {
            getAuth,
            createUserWithEmailAndPassword,
            signInWithEmailAndPassword,
            onAuthStateChanged,
            signOut
        } from 'https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js';

        // Variáveis globais fornecidas pelo ambiente Canvas
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id'; // Fallback para 'default-app-id' para testes locais
        const firebaseConfigString = typeof __firebase_config !== 'undefined' ? __firebase_config : JSON.stringify({
            apiKey: "AIzaSyDVwW_stGdkYpArCLjqsDbBsUiaSihGsUE",
            authDomain: "bossdv-72d16.firebaseapp.com",
            databaseURL: "https://bossdv-72d16-default-rtdb.firebaseio.com",
            projectId: "bossdv-72d16",
            storageBucket: "bossdv-72d16.firebasestorage.app",
            messagingSenderId: "141528827265",
            appId: "1:141528827265:web:531737e108e484a0869480" // Este é um exemplo, verifique o seu no console!
        });
        const firebaseConfig = JSON.parse(firebaseConfigString);

        // Inicializa o Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        const githubPagesBaseUrl = 'https://kronah.github.io/Token_boss/';

        // Referências aos elementos HTML
        const emailInput = document.getElementById('email');
        const passwordInput = document.getElementById('password'); 
        const loginButton = document.getElementById('login-button');
        const signupButton = document.getElementById('signup-button');
        const messageDisplay = document.getElementById('message');
        const loginForm = document.getElementById('login-form');

        // Função para exibir mensagens na tela
        function showMessage(text, isError = false) {
            messageDisplay.textContent = text;
            if (isError) {
                messageDisplay.className = 'text-center text-sm mt-4 text-red-600 font-medium';
            } else {
                messageDisplay.className = 'text-center text-sm mt-4 text-green-600 font-medium';
            }
        }

        // --- Lógica de Autenticação ---

        // Listener para o estado de autenticação (se o utilizador está autenticado ou não)
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // Utilizador autenticado: redireciona para a nova página (Gerador de Tokens)
                window.location.href = `${githubPagesBaseUrl}token_generator.html`;
            } else {
                // Utilizador desautenticado: mantém o formulário de login visível
                loginForm.classList.remove('hidden');
                showMessage(''); // Limpa a mensagem
            }
        });

        // Evento de clique para o botão de Login
        loginButton.addEventListener('click', async () => {
            const email = emailInput.value;
            const password = passwordInput.value;
            if (!email || !password) {
                showMessage('Por favor, preencha o email e a senha.', true);
                return;
            }
            try {
                await signInWithEmailAndPassword(auth, email, password);
                // onAuthStateChanged vai lidar com o redirecionamento
            } catch (error) {
                let errorMessage;
                switch (error.code) {
                    case 'auth/wrong-password':
                        errorMessage = 'Senha incorreta.';
                        break;
                    case 'auth/user-not-found':
                        errorMessage = 'Utilizador não encontrado.';
                        break;
                    case 'auth/invalid-email':
                        errorMessage = 'Formato de email inválido.';
                        break;
                    case 'auth/user-disabled':
                        errorMessage = 'Esta conta foi desativada.';
                        break;
                    case 'auth/operation-not-allowed': // Adicionado tratamento de erro específico
                        errorMessage = 'Autenticação por Email/Senha não está ativada no Firebase. Por favor, ative-a nas configurações do seu projeto.';
                        break;
                    default:
                        errorMessage = `Erro ao autenticar: ${error.message}`;
                }
                showMessage(errorMessage, true);
                console.error('Erro de autenticação:', error);
            }
        });

        // Evento de clique para o botão de Cadastro
        signupButton.addEventListener('click', async () => {
            const email = emailInput.value;
            const password = passwordInput.value;
            if (!email || !password) {
                showMessage('Por favor, preencha o email e a senha.', true);
                return;
            }
            // A senha deve ter pelo menos 6 caracteres para o Firebase
            if (password.length < 6) {
                showMessage('A senha deve ter pelo menos 6 caracteres.', true);
                return;
            }

            try {
                await createUserWithEmailAndPassword(auth, email, password);
                // onAuthStateChanged vai lidar com o redirecionamento
            } catch (error) {
                let errorMessage;
                switch (error.code) {
                    case 'auth/email-already-in-use':
                        errorMessage = 'Este email já está em uso.';
                        break;
                    case 'auth/invalid-email':
                        errorMessage = 'Formato de email inválido.';
                        break;
                    case 'auth/weak-password':
                        errorMessage = 'A senha é muito fraca. Escolha uma mais forte.';
                        break;
                    case 'auth/operation-not-allowed': // Adicionado tratamento de erro específico
                        errorMessage = 'Autenticação por Email/Senha não está ativada no Firebase. Por favor, ative-a nas configurações do seu projeto.';
                        break;
                    default:
                        errorMessage = `Erro ao criar conta: ${error.message}`;
                }
                showMessage(errorMessage, true);
                console.error('Erro de registo:', error);
            }
        });
    </script>
</body>
</html>
